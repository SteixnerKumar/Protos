/*
 *	THINC Lab at UGA | Cyber Deception Group
 *
 *	Author: Aditya Shinde
 * 
 *	email: shinde.aditya386@gmail.com
 */
package thinclab.spuddx_parser;

import java.io.FileInputStream;
import java.io.InputStream;

import org.antlr.v4.runtime.ANTLRInputStream;
import org.antlr.v4.runtime.CommonTokenStream;
import org.antlr.v4.runtime.TokenStream;
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

/*
 * @author adityas
 *
 */
public class SpuddXParserWrapper {

	/*
	 * Wrapper for SPUDDX wrapper generated by ANTLR4. Implements the visitor
	 * methods for each statement.
	 */

	private String fileName;
	private SpuddXParser parser;
	
	private static final Logger LOGGER = LogManager.getLogger(SpuddXParserWrapper.class);

	// ---------------------------------------------------------------
	// Implementation of ANTLR4 visitors

	private class VarValueVisitor extends SpuddXBaseVisitor<String> {

		@Override
		public String visitVar_value(SpuddXParser.Var_valueContext ctx) {
			return ctx.getText();
		}
	}

	public SpuddXParserWrapper(String fileName) {
		
		this.fileName = fileName;
		
		try {

			// Get tokens from lexer
			InputStream is = new FileInputStream(this.fileName);
			ANTLRInputStream antlrIs = new ANTLRInputStream(is);
			SpuddXLexer lexer = new SpuddXLexer(antlrIs);
			TokenStream tokens = new CommonTokenStream(lexer);
			
			this.parser = new SpuddXParser(tokens);
			
		}

		catch (Exception e) {
			LOGGER.error(String.format(
					"Error while trying to parse %s: %s", this.fileName, e));
			System.exit(-1);
		}
	}

	public String parseVarValues() {
		
		VarValueVisitor visitor = new VarValueVisitor();
		return visitor.visit(this.parser.domain());
	}

}
